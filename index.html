<!DOCTYPE html>
<html>
<body >
<style type="text/css">
.button {
    background-color: #4CAF50;
    border: none;
    color: white;
    padding: 15px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px;
    cursor: pointer;
}
/* The container */
.container {
    display: block;
    position: relative;
    padding-left: 55px;
    margin-bottom: 50px;
    cursor: pointer;
    font-size: 22px;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

.error-message
{
  
}
/* Hide the browser's default radio button */
.container input {
    position: absolute;
    opacity: 0;
    cursor: pointer;
}

/* Create a custom radio button */
.checkmark {
    position: absolute;
    top: 0;
    left: 0;
    height: 50px;
    width: 50px;
    background-color: #eee;
    border-radius: 50%;
}

/* On mouse-over, add a grey background color */
.container:hover input ~ .checkmark {
    background-color: #ccc;
}
.column {
    float: left;
    width: 50%;
}

/* Clear floats after the columns */
.row:after {
    content: "";
    display: table;
    clear: both;
}
/* When the radio button is checked, add a blue background */
.container input:checked ~ .checkmark {
    background-color: #2196F3;
}

/* Create the indicator (the dot/circle - hidden when not checked) */
.checkmark:after {
    content: "";
    position: absolute;
    display: none;
}

/* Show the indicator (dot/circle) when checked */
.container input:checked ~ .checkmark:after {
    display: block;
}

/* Style the indicator (dot/circle) */
.container .checkmark:after {
 	top: 13px;
	left: 13px;
	width: 25px;
	height: 25px;
	border-radius: 50%;
	background: white;
}

</style>
<div class="row">

  <div class="column">
  <h1>Choose issue type and Press Log button</h1>
  <p>Made <span></span> by @annerajb</p>

  <label class="container">
    Start Drive
    <input type="radio" name="type" value="start" checked> 	<span class="checkmark"></span>
    </label>

   <label class="container">
   Red steering wheel
    <input type="radio" name="type" value="ap-red-wheel" > 
    	<span class="checkmark"></span>
    </label>

   <label class="container">
    Auto Lane Change - Car Cancelled
    <input type="radio" name="type" value="auto-lane-change-car-cancel">
    <span class="checkmark"></span>
    </label>
    <label class="container">
    Auto Lane Change - Manual Override
    <input type="radio" name="type" value="auto-lane-change-manual-override">
    <span class="checkmark"></span>
    </label>
    <label class="container">
    Autopilot Disengaged - Lanes
    <input type="radio" name="type" value="ap-disengagement-car-lines">
    <span class="checkmark"></span>
    </label>
    <label class="container">
    User Disengaged - Lanes
    <input type="radio" name="type" value="ap-disengagement-user-lines">
    <span class="checkmark"></span>
    </label>

    <label class="container">
    Navigate on Autopilot - Route
    <input type="radio" name="type" value="noa-route">
    <span class="checkmark"></span>
    </label>
     <label class="container">
    Navigate on Autopilot - Faster lane suggestion
    <input type="radio" name="type" value="noa-lane">
    <span class="checkmark"></span>
    </label>
    <label class="container">
      Shadow braking
      <input type="radio" name="type" value="shadow-braking">
      <span class="checkmark"></span>
    </label>

    <label class="container">

    <button class="button" onclick="getLocation()">Log event/issue</button>
    </label>
  </div>

  <div class="column">
  <p class="h2 error-message" id="error_message">
  
  </p>
      <ul id="demo"></ul>
  </div>
<div>
<script>

var x = document.getElementById("demo");
var error_text = document.getElementById("error_message");
var start_timestamp = new Date();
var dbName = "tesla-autopilot-log";
var localStorageTempObject = [];
var lastLogEntry = {Timestamp:null, 
Event:null,
Coords:null};
function startDrive()
{
	start_timestamp = new Date();
  localStorage.clear()
   //var request = indexedDB.open(dbName, 3);
}
function logPersistentEvent(event, time,coordinates)
{
  
  var logItem = {Timestamp:time, Event:event,Coords:coordinates};
  localStorageTempObject.push(logItem);
  
  localStorage.lastLoggedDrive = JSON.stringify(localStorageTempObject);
}
function writeErrorMessage(message)
{
	error_text.innerHTML = message;
}
function geo_error(err)
{
	writeErrorMessage(`ERROR(${err.code}): ${err.message}`);
}
function getLocation() 
{
//callback for button press
		var selected_type = document.querySelector('input[name="type"]:checked').value;
    if(selected_type == "start")
    {
    	startDrive();
      logEntry("Started drive:"+start_timestamp.toLocaleString());
      logPersistentEvent("started",start_timestamp,null);
    }
    if (navigator.geolocation)
    {
        navigator.geolocation.getCurrentPosition(showPosition,geo_error);
        var selected_type = document.querySelector('input[name="type"]:checked').value;

        lastLogEntry.Event = selected_type; 
        lastLogEntry.Timestamp = new Date;
      
    } else 
    { 
        writeErrorMessage("Geolocation is not supported by this browser.");
    }
}
function updateLastLogEntry()
{
	 var content  = "Latitude: " + lastLogEntry.Coords.latitude + 
      "<br>Longitude: " + lastLogEntry.Coords.longitude+ 
      "<br> Local Time:" + lastLogEntry.Timestamp.toLocaleString() +
      "<br> Event Type:" + lastLogEntry.Event;
    logEntry(content);
 
}
function logEntry(content)
{
 		var pnode = document.createElement("p");
    pnode.innerHTML = content;
    var textnode = document.createElement("li");
    textnode.appendChild(pnode);
    x.insertBefore(textnode,x.childNodes[0]);
}
function logLastEventToPersistent()
{
logPersistentEvent(lastLogEntry.Event,lastLogEntry.Timestamp, lastLogEntry.Coords);
}
function showPosition(position) 
{

 	lastLogEntry.Coords = position.coords;
  updateLastLogEntry();
  //update persistent database
  logLastEventToPersistent();
}
</script>

</body>
</html>
